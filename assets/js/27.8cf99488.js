(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{323:function(t,a){t.exports="data:image/png;base64,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"},446:function(t,a,s){"use strict";s.r(a);var n=s(11),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"hystrix-隔离策略细粒度控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hystrix-隔离策略细粒度控制"}},[t._v("#")]),t._v(" Hystrix 隔离策略细粒度控制")]),t._v(" "),a("p",[t._v("Hystrix 实现资源隔离，有两种策略：")]),t._v(" "),a("ul",[a("li",[t._v("线程池隔离")]),t._v(" "),a("li",[t._v("信号量隔离")])]),t._v(" "),a("p",[t._v("对资源隔离这一块东西，其实可以做一定细粒度的一些控制。")]),t._v(" "),a("h3",{attrs:{id:"execution-isolation-strategy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execution-isolation-strategy"}},[t._v("#")]),t._v(" execution.isolation.strategy")]),t._v(" "),a("p",[t._v("指定了 HystrixCommand.run() 的资源隔离策略："),a("code",[t._v("THREAD")]),t._v(" or "),a("code",[t._v("SEMAPHORE")]),t._v("，一种基于线程池，一种基于信号量。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to use thread isolation")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withExecutionIsolationStrategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutionIsolationStrategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("THREAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to use semaphore isolation")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withExecutionIsolationStrategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutionIsolationStrategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SEMAPHORE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("线程池机制，每个 command 运行在一个线程中，限流是通过线程池的大小来控制的；信号量机制，command 是运行在调用线程中（也就是 Tomcat 的线程池），通过信号量的容量来进行限流。")]),t._v(" "),a("p",[t._v("如何在线程池和信号量之间做选择？")]),t._v(" "),a("p",[a("strong",[t._v("默认的策略")]),t._v("就是线程池。")]),t._v(" "),a("p",[a("strong",[t._v("线程池")]),t._v("其实最大的好处就是对于网络访问请求，如果有超时的话，可以避免调用线程阻塞住。")]),t._v(" "),a("p",[t._v("而使用信号量的场景，通常是针对超大并发量的场景下，每个服务实例每秒都几百的 "),a("code",[t._v("QPS")]),t._v("，那么此时你用线程池的话，线程一般不会太多，可能撑不住那么高的并发，如果要撑住，可能要耗费大量的线程资源，那么就是用信号量，来进行限流保护。一般用信号量常见于那种基于纯内存的一些业务逻辑服务，而不涉及到任何网络访问请求。")]),t._v(" "),a("h3",{attrs:{id:"command-key-command-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-key-command-group"}},[t._v("#")]),t._v(" command key & command group")]),t._v(" "),a("p",[t._v("我们使用线程池隔离，要怎么对"),a("strong",[t._v("依赖服务")]),t._v("、"),a("strong",[t._v("依赖服务接口")]),t._v("、"),a("strong",[t._v("线程池")]),t._v("三者做划分呢？")]),t._v(" "),a("p",[t._v("每一个 command，都可以设置一个自己的名称 command key，同时可以设置一个自己的组 command group。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Setter")]),t._v(" cachedSetter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withGroupKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandGroupKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExampleGroup"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("andCommandKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HelloWorld"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandHelloWorld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cachedSetter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("command group 是一个非常重要的概念，默认情况下，就是通过 command group 来定义一个线程池的，而且还会通过 command group 来聚合一些监控和报警信息。同一个 command group 中的请求，都会进入同一个线程池中。")]),t._v(" "),a("h3",{attrs:{id:"command-thread-pool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-thread-pool"}},[t._v("#")]),t._v(" command thread pool")]),t._v(" "),a("p",[t._v("ThreadPoolKey 代表了一个 HystrixThreadPool，用来进行统一监控、统计、缓存。默认的 ThreadPoolKey 就是 command group 的名称。每个 command 都会跟它的 ThreadPoolKey 对应的 ThreadPool 绑定在一起。")]),t._v(" "),a("p",[t._v("如果不想直接用 command group，也可以手动设置 ThreadPool 的名称。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Setter")]),t._v(" cachedSetter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withGroupKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandGroupKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExampleGroup"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("andCommandKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HelloWorld"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("andThreadPoolKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixThreadPoolKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HelloWorldPool"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandHelloWorld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cachedSetter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"command-key-command-group-command-thread-pool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-key-command-group-command-thread-pool"}},[t._v("#")]),t._v(" command key & command group & command thread pool")]),t._v(" "),a("p",[a("strong",[t._v("command key")]),t._v(" ，代表了一类 command，一般来说，代表了下游依赖服务的某个接口。")]),t._v(" "),a("p",[a("strong",[t._v("command group")]),t._v(" ，代表了某一个下游依赖服务，这是很合理的，一个依赖服务可能会暴露出来多个接口，每个接口就是一个 command key。command group 在逻辑上对一堆 command key 的调用次数、成功次数、timeout 次数、失败次数等进行统计，可以看到某一个服务整体的一些访问情况。"),a("strong",[t._v("一般来说，推荐根据一个服务区划分出一个线程池，command key 默认都是属于同一个线程池的。")])]),t._v(" "),a("p",[t._v("比如说有一个服务 A，你估算出来服务 A 每秒所有接口加起来的整体 "),a("code",[t._v("QPS")]),t._v(" 在 100 左右，你有一个服务 B 去调用服务 A。你的服务 B 部署了 10 个实例，每个实例上，用 command group 去对应下游服务 A。给一个线程池，量大概是 10 就可以了，这样服务 B 对服务 A 整体的访问 QPS 就大概是每秒 100 了。")]),t._v(" "),a("p",[t._v("但是，如果说 command group 对应了一个服务，而这个服务暴露出来的几个接口，访问量很不一样，差异非常之大。你可能就希望在这个服务对应 command group 的内部，包含对应多个接口的 command key，做一些细粒度的资源隔离。"),a("strong",[t._v("就是说，希望对同一个服务的不同接口，使用不同的线程池。")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("command key -> command group\n\ncommand key -> 自己的 thread pool key\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("逻辑上来说，多个 command key 属于一个 command group，在做统计的时候，会放在一起统计。每个 command key 有自己的线程池，每个接口有自己的线程池，去做资源隔离和限流。")]),t._v(" "),a("p",[t._v("说白点，就是说如果你的 command key 要用自己的线程池，可以定义自己的 thread pool key，就 ok 了。")]),t._v(" "),a("h3",{attrs:{id:"coresize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coresize"}},[t._v("#")]),t._v(" coreSize")]),t._v(" "),a("p",[t._v("设置线程池的大小，默认是 10。一般来说，用这个默认的 10 个线程大小就够了。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixThreadPoolProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withCoreSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"queuesizerejectionthreshold"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#queuesizerejectionthreshold"}},[t._v("#")]),t._v(" queueSizeRejectionThreshold")]),t._v(" "),a("p",[t._v("如果说线程池中的 10 个线程都在工作中，没有空闲的线程来做其它的事情，此时再有请求过来，会先进入队列积压。如果说队列积压满了，再有请求过来，就直接 reject，拒绝请求，执行 fallback 降级的逻辑，快速返回。")]),t._v(" "),a("p",[a("img",{attrs:{src:s(323),alt:"hystrix-thread-pool-queue"}})]),t._v(" "),a("p",[t._v("控制 queue 满了之后 reject 的 threshold，因为 maxQueueSize 不允许热修改，因此提供这个参数可以热修改，控制队列的最大大小。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixThreadPoolProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withQueueSizeRejectionThreshold")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"execution-isolation-semaphore-maxconcurrentrequests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execution-isolation-semaphore-maxconcurrentrequests"}},[t._v("#")]),t._v(" execution.isolation.semaphore.maxConcurrentRequests")]),t._v(" "),a("p",[t._v("设置使用 SEMAPHORE 隔离策略的时候允许访问的最大并发量，超过这个最大并发量，请求直接被 reject。")]),t._v(" "),a("p",[t._v("这个并发量的设置，跟线程池大小的设置，应该是类似的，但是基于信号量的话，性能会好很多，而且 Hystrix 框架本身的开销会小很多。")]),t._v(" "),a("p",[t._v("默认值是 10，尽量设置的小一些，因为一旦设置的太大，而且有延时发生，可能瞬间导致 tomcat 本身的线程资源被占满。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withExecutionIsolationSemaphoreMaxConcurrentRequests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);