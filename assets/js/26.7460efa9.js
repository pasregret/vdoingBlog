(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{322:function(s,t){s.exports="data:image/png;base64,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"},445:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"基于-hystrix-线程池技术实现资源隔离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于-hystrix-线程池技术实现资源隔离"}},[s._v("#")]),s._v(" 基于 Hystrix 线程池技术实现资源隔离")]),s._v(" "),t("p",[t("a",{attrs:{href:"./282.%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E8%AF%A6%E6%83%85%E9%A1%B5%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"}},[s._v("上一讲")]),s._v("提到，如果从 Nginx 开始，缓存都失效了，Nginx 会直接通过缓存服务调用商品服务获取最新商品数据（我们基于电商项目做个讨论），有可能出现调用延时而把缓存服务资源耗尽的情况。这里，我们就来说说，怎么通过 Hystrix 线程池技术实现资源隔离。")]),s._v(" "),t("p",[s._v("资源隔离，就是说，你如果要把对某一个依赖服务的所有调用请求，全部隔离在同一份资源池内，不会去用其它资源了，这就叫资源隔离。哪怕对这个依赖服务，比如说商品服务，现在同时发起的调用量已经到了 1000，但是分配给商品服务线程池内就 10 个线程，最多就只会用这 10 个线程去执行。不会因为对商品服务调用的延迟，将 Tomcat 内部所有的线程资源全部耗尽。")]),s._v(" "),t("p",[s._v("Hystrix 进行资源隔离，其实是提供了一个抽象，叫做 Command。这也是 Hystrix 最最基本的资源隔离技术。")]),s._v(" "),t("h3",{attrs:{id:"利用-hystrixcommand-获取单条数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#利用-hystrixcommand-获取单条数据"}},[s._v("#")]),s._v(" 利用 HystrixCommand 获取单条数据")]),s._v(" "),t("p",[s._v("我们通过将调用商品服务的操作封装在 HystrixCommand 中，限定一个 key，比如下面的 "),t("code",[s._v("GetProductInfoCommandGroup")]),s._v("，在这里我们可以简单认为这是一个线程池，每次调用商品服务，就只会用该线程池中的资源，不会再去用其它线程资源了。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfoCommand")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixCommand")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfoCommand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixCommandGroupKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Factory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("asKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GetProductInfoCommandGroup"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("productId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8081/getProductInfo?productId="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 调用商品服务接口")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" response "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpClientUtils")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendGetRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("我们在缓存服务接口中，根据 productId 创建 Command 并执行，获取到商品数据。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/getProductInfo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ResponseBody")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixCommand")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" getProductInfoCommand "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfoCommand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过command执行，获取最新商品数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),s._v(" productInfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" getProductInfoCommand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("productInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("上面执行的是 execute() 方法，其实是同步的。也可以对 command 调用 queue() 方法，它仅仅是将 command 放入线程池的一个等待队列，就立即返回，拿到一个 Future 对象，后面可以继续做其它一些事情，然后过一段时间对 Future 调用 get() 方法获取数据。这是异步的。")]),s._v(" "),t("h3",{attrs:{id:"利用-hystrixobservablecommand-批量获取数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#利用-hystrixobservablecommand-批量获取数据"}},[s._v("#")]),s._v(" 利用 HystrixObservableCommand 批量获取数据")]),s._v(" "),t("p",[s._v("只要是获取商品数据，全部都绑定到同一个线程池里面去，我们通过 HystrixObservableCommand 的一个线程去执行，而在这个线程里面，批量把多个 productId 的 productInfo 拉回来。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfosCommand")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixObservableCommand")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfosCommand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 还是绑定在同一个线程池")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixCommandGroupKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Factory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("asKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GetProductInfoGroup"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("productIds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Observable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Observable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unsafeCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Observable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OnSubscribe")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" subscriber "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" productId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 批量获取商品数据")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8081/getProductInfo?productId="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" productId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" response "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpClientUtils")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendGetRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),s._v(" productInfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                subscriber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("productInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            subscriber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onCompleted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribeOn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Schedulers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("io")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("在缓存服务接口中，根据传来的 id 列表，比如是以 "),t("code",[s._v(",")]),s._v(" 分隔的 id 串，通过上面的 HystrixObservableCommand，执行 Hystrix 的一些 API 方法，获取到所有商品数据。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getProductInfos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" productIdArray "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" productIds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HystrixObservableCommand")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" getProductInfosCommand "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetProductInfosCommand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("productIdArray"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Observable")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" observable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" getProductInfosCommand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("observe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    observable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Observer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onCompleted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"获取完了所有的商品数据"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n         * 获取完一条数据，就回调一次这个方法\n         * @param productInfo\n         */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductInfo")]),s._v(" productInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("productInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("我们回过头来，看看 Hystrix 线程池技术是如何实现资源隔离的。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(322),alt:"hystrix-thread-pool-isolation"}})]),s._v(" "),t("p",[s._v("从 Nginx 开始，缓存都失效了，那么 Nginx 通过缓存服务去调用商品服务。缓存服务默认的线程大小是 10 个，最多就只有 10 个线程去调用商品服务的接口。即使商品服务接口故障了，最多就只有 10 个线程会 hang 死在调用商品服务接口的路上，缓存服务的 Tomcat 内其它的线程还是可以用来调用其它的服务，干其它的事情。")])])}),[],!1,null,null,null);t.default=e.exports}}]);