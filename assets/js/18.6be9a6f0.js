(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{339:function(A,e){A.exports="data:image/png;base64,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"},340:function(A,e,t){A.exports=t.p+"assets/img/es-cluster.bf9b6e83.png"},460:function(A,e,t){"use strict";t.r(e);var r=t(11),d=Object(r.a)({},(function(){var A=this,e=A._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":A.$parent.slotKey}},[e("h2",{attrs:{id:"面试题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面试题"}},[A._v("#")]),A._v(" 面试题")]),A._v(" "),e("p",[A._v("ES 的分布式架构原理能说一下么（ES 是如何实现分布式的啊）？")]),A._v(" "),e("h2",{attrs:{id:"面试官心理分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面试官心理分析"}},[A._v("#")]),A._v(" 面试官心理分析")]),A._v(" "),e("p",[A._v("在搜索这块，lucene 是最流行的搜索库。几年前业内一般都问，你了解 lucene 吗？你知道倒排索引的原理吗？现在早已经 out 了，因为现在很多项目都是直接用基于 lucene 的分布式搜索引擎—— ElasticSearch，简称为 ES。")]),A._v(" "),e("p",[A._v("而现在分布式搜索基本已经成为大部分互联网行业的 Java 系统的标配，其中尤为流行的就是 ES，前几年 ES 没火的时候，大家一般用 solr。但是这两年基本大部分企业和项目都开始转向 ES 了。")]),A._v(" "),e("p",[A._v("所以互联网面试，肯定会跟你聊聊分布式搜索引擎，也就一定会聊聊 ES，如果你确实不知道，那你真的就 out 了。")]),A._v(" "),e("p",[A._v("如果面试官问你第一个问题，确实一般都会问你 ES 的分布式架构设计能介绍一下么？就看看你对分布式搜索引擎架构的一个基本理解。")]),A._v(" "),e("h2",{attrs:{id:"面试题剖析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面试题剖析"}},[A._v("#")]),A._v(" 面试题剖析")]),A._v(" "),e("p",[A._v("ElasticSearch 设计的理念就是分布式搜索引擎，底层其实还是基于 lucene 的。核心思想就是在多台机器上启动多个 ES 进程实例，组成了一个 ES 集群。")]),A._v(" "),e("p",[A._v("ES 中存储数据的"),e("strong",[A._v("基本单位是索引")]),A._v("，比如说你现在要在 ES 中存储一些订单数据，你就应该在 ES 中创建一个索引 "),e("code",[A._v("order_idx")]),A._v(" ，所有的订单数据就都写到这个索引里面去，一个索引差不多就是相当于是 mysql 里的一个数据库。")]),A._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[A._v("index -> type -> mapping -> document -> field\n")])]),A._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[A._v("1")]),e("br")])]),e("p",[A._v("这样吧，为了做个更直白的介绍，我在这里做个类比。但是切记，不要划等号，类比只是为了便于理解。")]),A._v(" "),e("p",[A._v("index 相当于 mysql 数据库。而 type 没法跟 mysql 里去对比，一个 index 里可以有多个 type，每个 type 的字段都是差不多的，但是有一些略微的差别。假设有一个 index，是订单 index，里面专门是放订单数据的。就好比说你在 mysql 中建表，有些订单是实物商品的订单，比如一件衣服、一双鞋子；有些订单是虚拟商品的订单，比如游戏点卡，话费充值。就两种订单大部分字段是一样的，但是少部分字段可能有略微的一些差别。")]),A._v(" "),e("p",[A._v("所以就会在订单 index 里，建两个 type，一个是实物商品订单 type，一个是虚拟商品订单 type，这两个 type 大部分字段是一样的，少部分字段是不一样的。")]),A._v(" "),e("p",[A._v("很多情况下，一个 index 里可能就一个 type，但是确实如果说是一个 index 里有多个 type 的情况（"),e("strong",[A._v("注意")]),A._v("， "),e("code",[A._v("mapping types")]),A._v(" 这个概念在 ElasticSearch 7. X 已被完全移除，详细说明可以参考"),e("a",{attrs:{href:"https://github.com/elastic/elasticsearch/blob/6.5/docs/reference/mapping/removal_of_types.asciidoc",target:"_blank",rel:"noopener noreferrer"}},[A._v("官方文档"),e("OutboundLink")],1),A._v("），你可以认为 index 是一个类别的表，具体的每个 type 代表了 mysql 中的一个表。每个 type 有一个 mapping，如果你认为一个 type 是具体的一个表，index 就代表多个 type 同属于的一个类型，而 mapping 就是这个 type 的"),e("strong",[A._v("表结构定义")]),A._v("，你在 mysql 中创建一个表，肯定是要定义表结构的，里面有哪些字段，每个字段是什么类型。实际上你往 index 里的一个 type 里面写的一条数据，叫做一条 document，一条 document 就代表了 mysql 中某个表里的一行，每个 document 有多个 field，每个 field 就代表了这个 document 中的一个字段的值。")]),A._v(" "),e("p",[e("img",{attrs:{src:t(339),alt:"es-index-type-mapping-document-field"}})]),A._v(" "),e("p",[A._v("你搞一个索引，这个索引可以拆分成多个 "),e("code",[A._v("shard")]),A._v(" ，每个 shard 存储部分数据。拆分多个 shard 是有好处的，一是"),e("strong",[A._v("支持横向扩展")]),A._v("，比如你数据量是 3T，3 个 shard，每个 shard 就 1T 的数据，若现在数据量增加到 4T，怎么扩展，很简单，重新建一个有 4 个 shard 的索引，将数据导进去；二是"),e("strong",[A._v("提高性能")]),A._v("，数据分布在多个 shard，即多台服务器上，所有的操作，都会在多台机器上并行分布式执行，提高了吞吐量和性能。")]),A._v(" "),e("p",[A._v("接着就是这个 shard 的数据实际是有多个备份，就是说每个 shard 都有一个 "),e("code",[A._v("primary shard")]),A._v(" ，负责写入数据，但是还有几个 "),e("code",[A._v("replica shard")]),A._v(" 。 "),e("code",[A._v("primary shard")]),A._v(" 写入数据之后，会将数据同步到其他几个 "),e("code",[A._v("replica shard")]),A._v(" 上去。")]),A._v(" "),e("p",[e("img",{attrs:{src:t(340),alt:"es-cluster"}})]),A._v(" "),e("p",[A._v("通过这个 replica 的方案，每个 shard 的数据都有多个备份，如果某个机器宕机了，没关系啊，还有别的数据副本在别的机器上呢。高可用了吧。")]),A._v(" "),e("p",[A._v("ES 集群多个节点，会自动选举一个节点为 master 节点，这个 master 节点其实就是干一些管理的工作的，比如维护索引元数据、负责切换 primary shard 和 replica shard 身份等。要是 master 节点宕机了，那么会重新选举一个节点为 master 节点。")]),A._v(" "),e("p",[A._v("如果是非 master 节点宕机了，那么会由 master 节点，让那个宕机节点上的 primary shard 的身份转移到其他机器上的 replica shard。接着你要是修复了那个宕机机器，重启了之后，master 节点会控制将缺失的 replica shard 分配过去，同步后续修改的数据之类的，让集群恢复正常。")]),A._v(" "),e("p",[A._v("说得更简单一点，就是说如果某个非 master 节点宕机了。那么此节点上的 primary shard 不就没了。那好，master 会让 primary shard 对应的 replica shard（在其他机器上）切换为 primary shard。如果宕机的机器修复了，修复后的节点也不再是 primary shard，而是 replica shard。")]),A._v(" "),e("p",[A._v("其实上述就是 ElasticSearch 作为分布式搜索引擎最基本的一个架构设计。")])])}),[],!1,null,null,null);e.default=d.exports}}]);